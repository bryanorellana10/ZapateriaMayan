@model ZapateriaMayan.ViewModels.SolicitudesViewModel

@{ ViewBag.Title = "Solicitudes";
    Layout = "~/Views/Shared/_Layout.cshtml"; }

@Html.Partial("_Mensaje")


<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-3">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">En Revisión</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a href="#">Producción</a></li>
                    <li class="breadcrumb-item active">En Revisión</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
        <div class="row mb-2">
            @*<div class="col-12">
                    <a href="@Url.Action("NuevaSolicitud","Produccion")" class="btn btn-primary">Generar Solicitud</a>
                </div>*@
        </div>


    </div><!-- /.container-fluid -->
</section>

<!-- Main content -->
<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">

            </div>
        </div>

        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">En Revisión</a>
            </li>
            @*<li class="nav-item">
                <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">No aceptados</a>
            </li>*@

        </ul>


        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Lista de productos en el area de Revisión.</h3>
                        <div>
                            <a href="" class="btn btn-outline-primary btn-xs float-right" style="margin:0.2em">
                                <i class="fas fa-th-large"></i>
                            </a>
                            <a href="" class="btn btn-primary btn-xs float-right" style="margin: 0.2em">
                                <i class="fas fa-list "></i>
                            </a>
                        </div>

                    </div>

                    <!-- /.card-header -->
                    <div class="card-body">
                        <div class="float-right">
                            <a class="btn btn-danger btn-sm text-white" id="cambiarAreaA_rechazar">Rechazar y Trasladar a Alistado</a>
                            <a class="btn btn-danger btn-sm text-white" id="cambiarAreaE_rechazar">Rechazar y Trasladar a Ensuelado</a>
                            <a class="btn btn-success btn-sm text-white" id="cambiarArea_aceptado">Aceptar y Mandar a Bodega</a>

                        </div>


                        <table id="tabla-enrevision" class="table table-bordered table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>Cod.</th>
                                    <th class="text-red">Ref. Solicitud</th>
                                    <th class="text-red">Ref. Pedido</th>
                                    <th>Imagen</th>
                                    <th>Talla</th>
                                    <th>Observacion</th>
                                    <th>Area</th>
                                    <th>Vendedor</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody class="tabla-Alistadoss">
                                @foreach (var detalle in Model.DetalleSolicitud)
                                {

                    <tr>

                        @*onclick = "location.href = '@Url.Action("DetalleSolicitud", "Produccion", new { id = detalle.SolicitudesId })'"*@

                        <td>  @detalle.Id </td>
                        <td class="text-red">
                            @detalle.SolicitudesId
                        </td>
                        <td class="text-red"> @detalle.Solicitudes.PedidoId</td>

                        <td>
                            <img src="~/Images/@detalle.ReservasProduc.DetalleTalla.Producto.Imagen" width="150" />
                        </td>
                        <td class="text-lg  text-bold">
                            @detalle.ReservasProduc.DetalleTalla.Talla.NombreTalla
                        </td>
                        <td class="text-lg">
                            @detalle.Observacion
                        </td>

                        <td class="text-center">

                            @detalle.Produccion.Area
                            <br /><br />
                            @*@Html.DropDownList("Areas", Model.Areas, new { @class = "form-control" })*@

                            @*<button class="btn btn-primary btn-xs cambiarArea">Trasladar</button>*@

                            <div class="form-group clearfix">
                                <div class="icheck-primary d-inline">
                                    <input type="checkbox" id="checkboxPrimary1" class="checkboxAlistados" style="width: 25px; height: 25px">
                                    <label for="checkboxPrimary1">
                                    </label>
                                </div>
                            </div>

                        </td>

                        <td>
                            @detalle.Solicitudes.Pedido.Vendedor
                        </td>

                        <td class="text-center">

                            @*<a class="btn btn-primary btn-xs" href="@Url.Action("ModificarContacto", "Clientes", new { id = cliente.Id})"><i class="fas fa-edit"></i></a>*@
                            <a class="btn btn-danger btn-sm" href="@Url.Action("DetalleSolicitud", "Produccion", new { id = detalle.SolicitudesId })"><i class="fas fa-info-circle"></i> Info</a>


                        </td>
                        @*<td class="text-center">
                                <a class="btn btn-success btn-sm" href="@Url.Action("","", new { })"> <i class="fas fa-check"></i></a>

                            </td>*@
                    </tr>}

                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Cod.</th>
                                    <th class="text-red">Ref. Solicitud</th>
                                    <th class="text-red">Ref. Pedido</th>
                                    <th>Imagen</th>
                                    <th>Talla</th>
                                    <th>Observacion</th>
                                    <th>Area</th>
                                    <th>Vendedor</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>


            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Lista de productos en Alistado NO ACEPTADOS - PRIORIDAD ALTA</h3>
                        <div>
                            <a href="" class="btn btn-outline-primary btn-xs float-right" style="margin:0.2em">
                                <i class="fas fa-th-large"></i>
                            </a>
                            <a href="" class="btn btn-primary btn-xs float-right" style="margin: 0.2em">
                                <i class="fas fa-list "></i>
                            </a>
                        </div>

                    </div>



                    <!-- /.card-header -->
                    <div class="card-body">
                        <table id="example2" class="table table-bordered table-striped table-hover">

                            <thead>
                                <tr>
                                    <th>Cod.</th>
                                    <th class="text-red">Ref. Solicitud</th>
                                    <th class="text-red">Ref. Pedido</th>
                                    <th>Imagen</th>
                                    <th>Atraso por </th>
                                    <th>Area</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var detalle in Model.DetalleSolicitud)
                                {


                                    if (detalle.Prioridad == true)
                                    {
                    <tr class="bg-gradient-danger">


                        @*onclick = "location.href = '@Url.Action("DetalleSolicitud", "Produccion", new { id = detalle.SolicitudesId })'"*@

                        <td>  @detalle.Id </td>
                        <td class="text-white"> @detalle.SolicitudesId </td>
                        <td class="text-white"> @detalle.Solicitudes.PedidoId</td>

                        <td>
                            <img src="~/Images/@detalle.ReservasProduc.DetalleTalla.Producto.Imagen" width="150" />
                        </td>
                        <td class="text-center">
                            ****
                        </td>

                        <td class="text-center">

                            @detalle.Produccion.Area
                            <br /><br />
                            @Html.DropDownList("Areas", Model.Areas, new { @class = "form-control" })
                            <br />

                            <button class="btn btn-primary btn-xs cambiarArea">Cambiar</button>
                        </td>



                        <td class="text-center">

                            @*<a class="btn btn-primary btn-xs" href="@Url.Action("ModificarContacto", "Clientes", new { id = cliente.Id})"><i class="fas fa-edit"></i></a>*@
                            <a class="btn btn-danger btn-sm" href="@Url.Action("DetalleSolicitud", "Produccion", new { id = detalle.SolicitudesId })"><i class="fas fa-info-circle"></i> Info</a>


                        </td>
                    </tr>}


                                }

                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Cod.</th>
                                    <th class="text-red">Ref. Solicitud</th>
                                    <th class="text-red">Ref. Pedido</th>
                                    <th>Imagen</th>
                                    <th>Estado</th>
                                    <th>Area</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
            <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">...</div>
        </div>


        <!-- /.row -->
    </div><!-- /.container-fluid -->
</div>

@section scripts{

    <script src="~/Scripts/bootstrap.bundle.js"></script>
    <script src="~/Scripts/jquery.dataTables.min.js"></script>
    <script src="~/Scripts/dataTables.bootstrap4.min.js"></script>
    <script src="~/Scripts/dataTables.responsive.min.js"></script>


    <script>
        $(function () {
            $("#tabla-enrevision").DataTable({
                "responsive": true,
                "autoWidth": false,
                "ordering": false
            });
        });

    </script>

    <script>
        
        // usando jquery
        //$("#tabla-enrevision tr").click(function () {
        //    //alert($(this).children("td").html());

        //    var child = $(this).children("td");

        //    var i = 0;
        //    var data = new Array();

        //    child.each(function () {

        //        switch (i) {
        //            case 6:
        //                //var selecteds = $(this).children('select#Areas').children("option").filter(":selected");
        //                //data[1] = selecteds;
        //                data[0] = $(this).children().children().children('input.checkboxAlistados');

        //                if (data[0][0].checked === true) {
        //                    data[0][0].checked = false;

        //                } else {
        //                    data[0][0].checked = true;
        //                }

        //                break;
        //        }
        //        i++;

        //    });

        //});


    </script>



    <script>

        $("#cambiarAreaA_rechazar").click(function (e) {
            e.preventDefault();

            // mi codigo
            //var checkedIds = [];
            //var i = 0;

            //var table = $("#tabla-alistados tr td").children().children().children(".checkboxAlistados");
            //var idTable = $("#tabla-alistados tr td");


            //for (var i = 0; i < table.length; i++) {
            //    if (table[i].checked) {
            //        checkedIds.push(idTable[1].innerHTML);
            //    }

            //}


            // otra manera
            var checkedIds = new Array();
            //loop through tbody > class checkboxAlistados
            var selectors = $("#tabla-enrevision tbody .checkboxAlistados:checked");
            selectors.each(function () {
            //get closest tr and then get Cod value
            checkedIds.push($(this).closest('tr').find("td:eq(0)").text())

            });


            var datos = JSON.stringify({
                Ids: checkedIds,
            });


            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                data: datos,
                url: "/Produccion/RechazarYTrasladarAAlistados/",
                success: function (result, state) {
                    alert(result);
                    location.reload();
                },
                error: function () {
                    alert("Un error interno ha ocurrido.")
                }

            });


        });


        $("#cambiarAreaE_rechazar").click(function (e) {
            e.preventDefault();

            // otra manera
            var checkedIds = new Array();
            //loop through tbody > class checkboxAlistados
            var selectors = $("#tabla-enrevision tbody .checkboxAlistados:checked");
            selectors.each(function () {
                //get closest tr and then get Cod value
                checkedIds.push($(this).closest('tr').find("td:eq(0)").text())

            });


            var datos = JSON.stringify({
                Ids: checkedIds,
            });


            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                data: datos,
                url: "/Produccion/RechazarYTrasladarAEnsuelados/",
                success: function (result, state) {
                    alert(result);
                    location.reload();
                },
                error: function () {
                    alert("Un error interno ha ocurrido.")
                }

            });


        });

        $("#cambiarArea_aceptado").click(function (e) {
            e.preventDefault();

            // otra manera
            var checkedIds = new Array();
            //loop through tbody > class checkboxAlistados
            var selectors = $("#tabla-enrevision tbody .checkboxAlistados:checked");
            selectors.each(function () {
                //get closest tr and then get Cod value
                checkedIds.push($(this).closest('tr').find("td:eq(0)").text())

            });


            var datos = JSON.stringify({
                Ids: checkedIds,
            });


            $.ajax({
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                type: 'POST',
                data: datos,
                url: "/Produccion/AceptarBodega/",
                success: function (result, state) {
                    alert(result);
                    location.reload();
                },
                error: function () {
                    alert("Un error interno ha ocurrido.")
                }

            });


        });




       


    </script>



}


